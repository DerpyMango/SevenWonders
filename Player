import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;

public class Player
{
    private int coins, milLosses, milVic, leftTradeCost, rightTradeCost;
    private WonderBoard wb;
    private static final HashMap<String, Integer> ownedMap = new HashMap<String, Integer>();
    {
        {
            ownedMap.put("resource", 0);
            ownedMap.put("military", 1);
            ownedMap.put("science", 2);
            ownedMap.put("commerce", 3);
            ownedMap.put("civil", 4);
            ownedMap.put("guild", 5);
            ownedMap.put("trade", 6);
            ownedMap.put("wb", 7);
        }
    };

    private static final HashMap<String, Integer> handMap = new HashMap<String, Integer>()
    {
        {
            ownedMap.put("resource", 0);
            ownedMap.put("military", 1);
            ownedMap.put("science", 2);
            ownedMap.put("commerce", 3);
            ownedMap.put("civil", 4);
            ownedMap.put("guild", 5);
        }
    };

    private ArrayList<Card>[] ownedCards, hand;

    public Player()
    {
        ownedCards = (ArrayList<Card>[])(new ArrayList[7]);
        hand = (ArrayList<Card>[])(new ArrayList[6]);


        setCoins(3);
        setMilLosses(0);
        setMilVic(0);
        setLeftTradeCost(2);
        setRightTradeCost(2);
    }

    public int getCoins()
    {
        return coins;
    }

    public int getMilLosses()
    {
        return milLosses;
    }

    public int getMilVics()
    {
        return milVic;
    }

    public int getLeftTradeCost()
    {
        return leftTradeCost;
    }

    public int getRightTradeCost()
    {
        return rightTradeCost;
    }

    public ArrayList<Card>[] getHand()
    {
        return hand;
    }

    public ArrayList<Card>[] getOwnedCards()
    {
        return ownedCards;
    }

    public void setCoins(int c)
    {
        coins = c;
    }

    public void addCoins(int c)
    {
        coins += c;
    }

    public void setMilLosses(int ml)
    {
        milLosses = ml;
    }

    public void addMilLoss(int losses)
    {
        milLosses += losses;
    }

    public void setMilVic(int mv)
    {
        milVic = mv;
    }

    public void addMilVic(int vics)
    {
        milVic += vics;
    }

    public void setWonderBoard(WonderBoard w)
    {
        wb = w;
    }

    public void setHand(ArrayList<Card>[] h)
    {
        hand = h;
    }

    public void setLeftTradeCost(int ltc)
    {
        leftTradeCost = ltc;
    }

    public void setRightTradeCost(int rtc)
    {
        rightTradeCost = rtc;
    }

    public boolean addToOwnedCards(Card c)
    {
        if (canAfford(c))
        {
            ownedCards[ownedMap.get(c.getType())].add(c);
            setCoins(coins - c.getCost().getRCost()[c.getCost().getRCost().length - 1]);
            return true;
        }

        else
            return false;

    }

    public boolean canAfford(Card c)
    {
        String p = c.getCost().getPrereq();

        if (p != null)
        {
            for (ArrayList<Card> a : ownedCards)
            {
                for (Card cc : a)
                {
                    if (cc.getName().equals(p))
                        return true;
                }
            }
        }

        int[] costarr = c.getCost().getRCost();
        int[] resources = new int[costarr.length];

        for (Card cc : ownedCards[ownedMap.get("resource")])
        {
            for (int i = 0; i < ((ResourceCard) cc).getResources().length; i++)
            {
                resources[i] += ((ResourceCard) cc).getResources()[i];
            }
        }

        for (Card cc : ownedCards[ownedMap.get("trade")])
        {
            for (int i = 0; i < ((ResourceCard) cc).getResources().length; i++)
            {
                resources[i] += ((ResourceCard) cc).getResources()[i];
            }
        }

        for (Card cc : ownedCards[ownedMap.get("wb")])
        {
            for (int i = 0; i < ((ResourceCard) cc).getResources().length; i++)
            {
                resources[i] += ((ResourceCard) cc).getResources()[i];
            }
        }

        resources[resources.length - 1] = coins;

        for (int i = 0; i < costarr.length; i++)
        {
            if (resources[i] < costarr[i])
                return false;
        }

        return true;
    }

    public boolean canAfford(Cost c)
    {
        int[] costarr = c.getRCost();
        int[] resources = new int[costarr.length];

        for (Card cc : ownedCards[ownedMap.get("resource")])
        {
            for (int i = 0; i < ((ResourceCard) cc).getResources().length; i++)
            {
                resources[i] += ((ResourceCard) cc).getResources()[i];
            }
        }

        for (Card cc : ownedCards[ownedMap.get("trade")])
        {
            for (int i = 0; i < ((ResourceCard) cc).getResources().length; i++)
            {
                resources[i] += ((ResourceCard) cc).getResources()[i];
            }
        }

        for (Card cc : ownedCards[ownedMap.get("wb")])
        {
            for (int i = 0; i < ((ResourceCard) cc).getResources().length; i++)
            {
                resources[i] += ((ResourceCard) cc).getResources()[i];
            }
        }

        resources[resources.length - 1] = coins;

        for (int i = 0; i < costarr.length; i++)
        {
            if (resources[i] < costarr[i])
                return false;
        }

        return true;
    }

    public boolean buildWonder(Card c)
    {
        if (canAfford(wb.returnWonderCost()))
        {
            wb.build();
            ownedCards[ownedMap.get(c.getType())].remove(c);
            return true;
        }
        return false;
    }

    public int wondersBuilt()
    {
        return wb.numWonders();
    }


    public int getMilStrength()
    {
        int ms = 0;

        for (Card c : ownedCards[ownedMap.get("military")])
        {
            ms += ((MilCard)c).getArmyCount();
        }

        return ms;
    }

    public int getCivPoints()
    {
        int points = 0;
        for (Card cc : ownedCards[ownedMap.get("civil")])
        {
            points += ((CivilCard)cc).getPoints();
        }

        return points;
    }

    public int getScientificPoints()
    {
        int points = 0;
        //Order is Math, Engi, Lit
        ArrayList<Integer> identicals = new ArrayList<Integer>();
        for (int i = 0; i < 3; i++)
        {
            identicals.add(0);
        }

        for (Card cc : ownedCards[ownedMap.get("science")])
        {
            if (((SciCard) cc).getStatus().equals("Math"))
            {
                identicals.set(0, identicals.get(0) + 1);
            }

            else if (((SciCard) cc).getStatus().equals("Engi"))
            {
                identicals.set(1, identicals.get(0) + 1);
            }

            else if (((SciCard) cc).getStatus().equals("Lit"))
            {
                identicals.set(2, identicals.get(0) + 1);
            }
        }

        for (int i = identicals.size(); i > -1; i--)
        {
            if (identicals.get(i) != 0)
                points += Math.pow(identicals.get(i), 2);
            else
                identicals.remove(i);
        }

        if (identicals.size() < 3)
            return points;

        Collections.sort(identicals);
        points += identicals.get(0) * 7;

        return points;
    }

    public int getGuildPoints()
    {
        //work in progress
    }

    public int getWonderPoints()
    {
        return wb.returnVictoPoints();
    }

    public int getCommPoints()
    {
        for (Card c : ownedCards[ownedMap.get("commerce")])
        {
            CommCard cc = ((CommCard)c);
            if (cc.getName().equals("Arena")|| cc.getName().equals("Lighthouse"))
            {
                //work in progress
            }
        }
    }

    public int getMilPoints()
    {
        return milVic - milLosses;
    }

    public int getTreasuryPoints()
    {
        return coins % 3;
    }


    public int calcVP()
    {
        return getCivPoints() + getScientificPoints() + getGuildPoints() + getWonderPoints() + getMilPoints() + getTreasuryPoints();
    }

}
